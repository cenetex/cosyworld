const API_BASE_URL="/api",ENDPOINTS={XAUTH:"/api/xauth"};class XService{async initiateXAuth(t){try{const e=await fetch(`${ENDPOINTS.XAUTH}/status/${t}`);if((await e.json()).authorized)return confirm("This avatar is already connected to X. Do you want to disconnect it?")?this.disconnectXAuth(t):{success:!1,error:"Operation cancelled"};const r=await fetch(`${ENDPOINTS.XAUTH}/initiate/${t}`,{method:"POST",headers:{"Content-Type":"application/json"}}),o=await r.json();if(o.authUrl){const t=window.open(o.authUrl,"xauth","width=600,height=800,status=yes,scrollbars=yes");if(!t||t.closed||void 0===t.closed)throw new Error("Popup blocked! Please allow popups for this website.");return{success:!0,popup:t}}throw new Error(o.error||"Failed to initiate X authorization")}catch(t){return console.error("X Auth Error:",t),{success:!1,error:t.message}}}async disconnectXAuth(t){try{const e=await fetch(`${ENDPOINTS.XAUTH}/disconnect/${t}`,{method:"POST",headers:{"Content-Type":"application/json"}}),r=await e.json();if(r.success)return{success:!0};throw new Error(r.error||"Failed to disconnect X authorization")}catch(t){return console.error("X Disconnect Error:",t),{success:!1,error:t.message}}}async checkXAuthStatus(t){try{const e=await fetch(`${ENDPOINTS.XAUTH}/status/${t}`),r=await e.json();return{success:!0,authorized:r.authorized||!1,requiresReauth:r.requiresReauth||!1,expiresAt:r.expiresAt,error:r.error}}catch(t){return console.error("X Status Check Error:",t),{success:!1,authorized:!1,error:t.message}}}async postToX(t,e){try{const r=await this.checkXAuthStatus(t);if(!r.authorized)throw new Error("This avatar is not authorized to post to X");if(r.requiresReauth)throw new Error("X authorization expired. Please reconnect.");const o=await fetch(`${ENDPOINTS.XAUTH}/post/${t}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({content:e})}),s=await o.json();if(s.success)return{success:!0,tweetId:s.tweetId,tweetUrl:s.tweetUrl};throw new Error(s.error||"Failed to post to X")}catch(t){return console.error("X Post Error:",t),{success:!1,error:t.message}}}}const xService=new XService;export default xService;