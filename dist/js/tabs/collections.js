import{CollectionsAPI}from"../core/api.js";export async function loadContent(){const e=document.getElementById("content");if(!e)return;e.innerHTML='\n    <div class="max-w-7xl mx-auto px-4">\n      <h1 class="text-3xl font-bold mb-6">Collections</h1>\n      <div id="collections-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 mb-8"></div>\n      <div id="collection-view" class="hidden">\n        <button id="back-to-collections" class="mb-4 px-3 py-1.5 bg-surface-800 rounded hover:bg-surface-700">‚Üê Back</button>\n        <h2 id="collection-title" class="text-2xl font-semibold mb-2"></h2>\n        <p id="collection-desc" class="text-gray-400 mb-4"></p>\n        <div id="collection-members" class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-5 gap-3"></div>\n        <div id="collection-loader" class="text-center py-8 hidden">\n          <div class="animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-primary-600 mx-auto"></div>\n          <p class="mt-2 text-gray-400">Loading more...</p>\n        </div>\n      </div>\n    </div>';const t=document.getElementById("collections-grid"),{collections:n}=await CollectionsAPI.list({limit:60});n?.length?(t.innerHTML=n.map(renderCollectionCard).join(""),t.querySelectorAll("[data-coll]").forEach((e=>{e.addEventListener("click",(()=>async function(e,n,o){t.classList.add("hidden"),document.getElementById("collection-view").classList.remove("hidden"),document.getElementById("collection-title").textContent=n||e,document.getElementById("collection-desc").textContent=o||"";const i=document.getElementById("collection-members"),l=document.getElementById("collection-loader");i.innerHTML="";let d=null,s=!1,c=!0;async function r(){if(!s&&c){s=!0,l.classList.remove("hidden");try{const t=await CollectionsAPI.members(e,{limit:30,after:d,thumbs:1});(t.avatars||[]).forEach((e=>{const t=document.createElement("div");t.className="cursor-pointer hover:bg-surface-800 rounded p-2",t.innerHTML=renderAvatarCard(e),t.onclick=()=>window.showAvatarDetails&&window.showAvatarDetails(e._id),i.appendChild(t)})),d=t.nextCursor,c=!!d}finally{s=!1,l.classList.toggle("hidden",!c)}}}window.loadMoreCollection=r,await r(),new IntersectionObserver((e=>{e[0].isIntersecting&&r()}),{threshold:.2}).observe(l)}(decodeURIComponent(e.dataset.coll),e.dataset.name?decodeURIComponent(e.dataset.name):void 0,e.dataset.desc?decodeURIComponent(e.dataset.desc):void 0)))}))):t.innerHTML='<div class="col-span-full text-center text-gray-400">No collections found.</div>',document.getElementById("back-to-collections").addEventListener("click",(()=>{document.getElementById("collection-view").classList.add("hidden"),t.classList.remove("hidden")}))}function renderCollectionCard(e){const t=(e.name||e.key||e.id).toString(),n=(e.description||"").toString();return`\n    <div data-coll="${encodeURIComponent(e.id)}" data-name="${encodeURIComponent(t)}" data-desc="${encodeURIComponent(n)}"\n         class="flex items-start gap-3 p-3 rounded-lg bg-surface-800 hover:bg-surface-700 cursor-pointer" >\n  <img src="${e.thumbnailUrl}" alt="${t}" class="w-12 h-12 rounded object-cover border border-surface-700 flex-shrink-0"\n       onerror="this.onerror=null; this.src='data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='48' height='48' viewBox='0 0 100 100'%3E%3Crect fill='%23333' width='100' height='100'/%3E%3Ctext fill='%23FFF' x='50' y='50' font-size='40' text-anchor='middle' dominant-baseline='middle'%3E${t.slice(0,1).toUpperCase()}%3C/text%3E%3C/svg%3E';"/>\n      <div class="flex-1 min-w-0">\n        <div class="font-semibold truncate">${t}</div>\n        ${n?`<div class="text-xs text-gray-400 line-clamp-2">${n}</div>`:""}\n        <div class="text-xs text-gray-500 mt-1">${e.count} avatars</div>\n      </div>\n    </div>`}function renderAvatarCard(e){const t=e.thumbnailUrl||e.imageUrl,n=(e.name||"?").slice(0,1).toUpperCase();return`\n    <div class="flex flex-col items-center">\n      <img src="${t}" alt="${e.name}" class="w-24 h-24 rounded-full object-cover border border-surface-700"\n           onerror="this.onerror=null; this.src='data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='100' height='100' viewBox='0 0 100 100'%3E%3Crect fill='%23333' width='100' height='100'/%3E%3Ctext fill='%23FFF' x='50' y='50' font-size='50' text-anchor='middle' dominant-baseline='middle'%3E${n}%3C/text%3E%3C/svg%3E';">\n      <div class="mt-2 text-sm font-medium truncate w-full text-center" title="${e.name}">${e.name}</div>\n    </div>`}