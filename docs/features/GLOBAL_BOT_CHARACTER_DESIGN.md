# Global Bot Character Design Feature

## Overview

The Global Bot now supports consistent character generation across all image and video outputs. This feature allows you to configure a specific character that will appear in all media generated by the global bot, ensuring brand consistency and character recognition.

## Features

- **Character Reference Image**: Upload or link to a character design that serves as visual reference
- **Character Description**: Detailed textual description of your character (appearance, clothing, style)
- **Custom Prompt Templates**: Configure how the character is referenced in image generation prompts
- **Toggle Control**: Enable/disable character insertion on demand
- **Automatic Integration**: Works seamlessly with both image and video generation

## Configuration

### Accessing the Settings

1. Navigate to the admin panel: `/admin/global-bot`
2. Scroll to the **"Character Design for Image Generation"** section
3. Click to expand the section

### Setting Up Your Character

#### 1. **Enable Character in Image Generation**
   - Check the box to enable character insertion in all generated media
   - When disabled, the bot will generate images without character constraints

#### 2. **Character Name**
   - Enter the name of your character (e.g., "CosyBot", "Luna", "Atlas")
   - This name will be used in prompts to reference the character

#### 3. **Character Reference Image URL**
   - Upload your character design to an S3 bucket or image hosting service
   - Paste the public URL here
   - Click "üëÅÔ∏è Preview Character Image" to verify the image loads correctly
   - The image will be displayed below the input field when loaded

#### 4. **Character Description**
   - Provide a detailed visual description of your character
   - Include:
     - Physical appearance (body type, colors, textures)
     - Clothing and accessories
     - Distinctive features or markings
     - Style or artistic direction
   
   **Example:**
   ```
   A friendly robot with a sleek blue metallic body, glowing green eyes, 
   wearing a red scarf. Has rounded features, a warm smile, and antenna 
   on top of the head. Style: 3D rendered, Pixar-like, vibrant colors.
   ```

#### 5. **Image Prompt Prefix Template**
   - Customize how the character is introduced in image generation prompts
   - Available variables:
     - `{{characterName}}` - Replaced with the character name
     - `{{characterDescription}}` - Replaced with the full character description
   
   **Default template:**
   ```
   Show {{characterName}} ({{characterDescription}}) in this situation: 
   ```
   
   **Custom examples:**
   ```
   Feature {{characterName}} prominently: {{characterDescription}}. Scene: 
   ```
   ```
   {{characterName}} - {{characterDescription}} - doing this: 
   ```

### Saving Your Configuration

1. Fill in all desired fields
2. Click **"üíæ Save Persona"** at the bottom of the page
3. You should see a success message confirming the save

## How It Works

### Image Generation

When a user requests image generation via the global bot (e.g., in Telegram):

**Without Character Design:**
```
User: "Generate an image of a sunset on a beach"
Actual Prompt: "a sunset on a beach"
```

**With Character Design Enabled:**
```
User: "Generate an image of a sunset on a beach"
Actual Prompt: "Show CosyBot (A friendly robot with blue metallic body, 
                glowing green eyes, wearing a red scarf) in this situation: 
                a sunset on a beach"
```

### Video Generation

The same character design is automatically applied to video generation requests, ensuring consistency across all media types.

### Technical Details

- The character prompt prefix is **prepended** to user requests automatically
- Template variables are replaced before sending to the image/video generation service
- The original user prompt is preserved in logs for debugging
- Character design applies to both `executeImageGeneration` and `executeVideoGeneration` functions

## Best Practices

### Character Description Tips

1. **Be Specific**: Include colors, materials, distinctive features
2. **Keep It Concise**: While detailed, avoid overly long descriptions (aim for 2-4 sentences)
3. **Mention Style**: Include artistic style or rendering preference
4. **Consistency Keywords**: Use terms that the AI will recognize across generations
5. **Test and Iterate**: Generate a few test images and refine the description

### Reference Image

- Use high-quality images (PNG or JPG)
- Clear, front-facing view works best
- Ensure the image is publicly accessible
- Consider using a character sheet or turnaround if available
- The reference image is currently for manual reference - future versions may integrate it directly into generation

### Prompt Prefix Templates

- Keep templates short and direct
- Front-load important information
- Test different templates to find what works best with your image generation service
- Remember that user context will be appended after your prefix

## Example Configuration

Here's a complete example for a character named "Cosmo":

```
‚úÖ Enable Character in Image Generation: CHECKED

Character Name: Cosmo

Character Reference Image URL: 
https://s3.amazonaws.com/your-bucket/characters/cosmo-reference.png

Character Description:
A whimsical space explorer with purple fur, large curious yellow eyes, 
wearing an orange spacesuit with a clear bubble helmet. Small antenna 
on top of head. Cartoon style with soft, rounded shapes and warm colors.

Image Prompt Prefix Template:
Show Cosmo ({{characterDescription}}) in this scene: 
```

## Troubleshooting

### Character Not Appearing in Images

1. Verify that "Enable Character in Image Generation" is checked
2. Confirm that you've saved the configuration
3. Check the character description is detailed enough
4. Review server logs for the enhanced prompt being used
5. Try adjusting the prompt template for better results

### Reference Image Not Loading

1. Ensure the URL is publicly accessible
2. Check that the URL is complete (includes `https://`)
3. Verify the image format is supported (JPG, PNG)
4. Try the "Preview Character Image" button to test the URL

### Inconsistent Results

1. Make the character description more specific
2. Add style keywords (e.g., "3D render", "anime", "photorealistic")
3. Test with different prompt prefix templates
4. Consider the limitations of the underlying image generation model

## Future Enhancements

Potential improvements for future versions:

- Direct integration of reference image into generation models
- Multiple character support (character library)
- Character variation settings (poses, expressions, angles)
- A/B testing of different character descriptions
- Character consistency scoring/feedback
- Upload interface for reference images (vs. URL only)

## API Integration

The character design configuration is stored in the global bot's `globalBotConfig.characterDesign` object:

```javascript
{
  enabled: boolean,
  characterName: string,
  referenceImageUrl: string,
  characterDescription: string,
  imagePromptPrefix: string
}
```

This configuration is automatically loaded and applied by the TelegramService when generating images or videos.

## Support

For issues or questions:
1. Check the server logs for detailed generation information
2. Verify your configuration in the admin panel
3. Test with simple prompts first before complex ones
4. Contact support with example prompts and expected vs. actual results
