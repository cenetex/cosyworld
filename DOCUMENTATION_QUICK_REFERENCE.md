# CosyWorld Documentation Quick Reference

**For LLM Agents & Developers** - Last Updated: October 2025

---

## ğŸ“š Documentation Map

### Start Here

| Document | Purpose | Audience |
|----------|---------|----------|
| **README.md** | User-facing overview, features, setup | Users, New Developers |
| **README.DEVELOPER.md** â­ | Developer onboarding and patterns | Developers, LLM Agents |
| **ARCHITECTURE.md** â­ | System design and data flow | Developers, LLM Agents, Architects |
| **docs/JSDOC_STANDARDS.md** | Documentation conventions | Contributors |

### Generated Documentation

| Type | Location | Generated By |
|------|----------|-------------|
| API Docs | `docs/api/` | `npm run docs:api` |
| Wiki | `docs/` | `npm run docs` |
| Coverage Report | Terminal output | `npm run docs:coverage` |

---

## ğŸš€ Quick Commands

```bash
# Development
npm run dev              # Start dev server (port 3001)
npm start                # Start production (port 3000)

# Documentation
npm run docs:api         # Generate JSDoc API docs
npm run docs:api:watch   # Auto-regenerate on changes
npm run docs:coverage    # Check documentation coverage
npm run docs:all         # Generate all docs

# Code Quality
npm run lint             # Run ESLint
npm run format           # Format code with Prettier
```

---

## ğŸ¯ For Developers

### First Time Setup

1. Read: `README.DEVELOPER.md` (Quick start)
2. Read: `ARCHITECTURE.md` (System design)
3. Run: `npm install`
4. Run: `npm start` (Visit setup wizard)
5. Run: `npm run dev` (Start developing)

### Understanding the Codebase

**Architecture Layers** (top to bottom):
```
Presentation â†’ Discord, Web UI, X/Twitter
Application  â†’ MessageHandler, ToolDecision, ResponseCoordinator
Domain       â†’ AvatarService, MemoryService, CombatService
AI           â†’ UnifiedAI, OpenRouter, Google AI
Foundation   â†’ Database, Config, Secrets, Logger
Data Access  â†’ Repositories (MongoDB)
```

**Key Files**:
- `src/container.mjs` - Dependency injection (start here!)
- `src/index.mjs` - Application entry point
- `src/services/ai/openrouterAIService.mjs` - Primary AI service
- `src/services/chat/messageHandler.mjs` - Message processing

### Common Tasks

**Add a New Service**:
```javascript
// 1. Create file: src/services/myCategory/myService.mjs
export class MyService {
  constructor({ logger, databaseService }) {
    this.logger = logger;
    this.db = databaseService;
  }
  
  async initialize() {
    // Async setup
  }
}

// 2. Auto-registered by container (filename â†’ camelCase)
// 3. Use: container.resolve('myService')
```

**Add a New Tool**:
```javascript
// See: README.DEVELOPER.md > Tools System
export class MyTool {
  static schema = { /* JSON Schema */ };
  static toolName = 'my_tool';
  
  async execute(params, context) {
    // Tool logic
  }
}
```

**Query Database**:
```javascript
// Always use repository pattern
const db = await this.dbService.getDatabase();
const collection = db.collection('my_collection');
const docs = await collection.find({}).toArray();
```

---

## ğŸ¤– For LLM Agents (Claude Sonnet 4.5)

### How to Navigate This Codebase

**Step 1**: Read file headers
- Every documented file has `@file`, `@context`, `@architecture`
- Tells you WHY the code exists and HOW it fits

**Step 2**: Follow data flow
- Look for `@dataflow` tags in JSDoc
- Traces data through the system

**Step 3**: Check examples
- Every public method has `@example` tags
- Shows real usage with imports and outputs

**Step 4**: Understand relationships
- Use `@see` tags to discover related code
- Check `ARCHITECTURE.md` for system-wide view

### Custom JSDoc Tags (Unique to CosyWorld)

| Tag | Purpose | Example |
|-----|---------|---------|
| `@context` | Why this code exists, what problem it solves | System integration notes |
| `@architecture` | Design patterns, dependencies, structure | DI container, singleton, etc. |
| `@lifecycle` | Initialization, runtime, shutdown | When methods are called |
| `@dataflow` | How data moves through the system | Request â†’ Service â†’ DB â†’ Response |
| `@performance` | Speed, memory, rate limits | O(n), 2s typical, caching notes |
| `@errors` | Error conditions and handling | What throws, what returns null |

### Reading Example

```javascript
/**
 * @context
 * OpenRouter provides unified access to 300+ AI models. This service
 * is CosyWorld's primary AI backend, handling model selection and
 * structured output generation.
 * 
 * @architecture
 * - Singleton service (registered in container.mjs)
 * - Uses OpenAI SDK with custom baseURL
 * - Fallback strategy: json_schema â†’ json_object â†’ instructions
 * 
 * @dataflow
 * Tool Request â†’ UnifiedAI â†’ [This Service] â†’ OpenRouter API
 * â†’ Provider â†’ Parse â†’ Validate â†’ Return
 */
```

This tells you:
1. **What**: OpenRouter AI integration
2. **Why**: Unified access to 300+ models
3. **How**: Singleton with OpenAI SDK
4. **When**: Used by tool requests
5. **Where**: Fits in the AI service layer

---

## ğŸ“– Key Concepts

### Dependency Injection

**Never use `new Service()`**. Always resolve from container:

```javascript
// âœ… Correct
const service = container.resolve('serviceName');

// âŒ Wrong
const service = new ServiceClass();
```

### Service Lifecycle

```
Constructor â†’ initialize() â†’ Runtime â†’ cleanup()
```

1. **Constructor**: Dependency injection (sync only)
2. **initialize()**: Async setup (optional)
3. **Runtime**: Handle requests
4. **cleanup()**: Graceful shutdown (optional)

### Event System

Decouple services with events:

```javascript
// Publish
eventBus.emit('avatar.created', { avatarId, metadata });

// Subscribe
eventBus.on('avatar.created', async (data) => {
  // React to event
});
```

### AI Model Tiers

```
Legendary â†’ GPT-4o, Claude Opus (complex reasoning)
Rare      â†’ Gemini Pro, Llama-70B (standard tasks)
Uncommon  â†’ Gemini Flash, Qwen-32B (fast responses)
Common    â†’ Llama-3B, Phi-3.5 (basic chat)
```

---

## ğŸ” Finding Information

### "How do I...?"

| Task | Resource |
|------|----------|
| Add a new service | README.DEVELOPER.md > Common Tasks |
| Understand DI container | ARCHITECTURE.md > Dependency Injection |
| Create a tool | README.DEVELOPER.md > Tools System |
| Query database | README.DEVELOPER.md > Database Operations |
| Handle AI requests | See `openrouterAIService.mjs` JSDoc |
| Debug issues | README.DEVELOPER.md > Debugging |
| Follow code style | README.DEVELOPER.md > Code Style |
| Contribute | README.DEVELOPER.md > Contributing |

### "What is...?"

| Concept | Resource |
|---------|----------|
| Avatar | ARCHITECTURE.md > Core Concepts > Avatars |
| Tool | ARCHITECTURE.md > Core Concepts > Tools |
| Memory | ARCHITECTURE.md > Memory Architecture |
| Tier | ARCHITECTURE.md > Core Concepts > Tiers |
| Service | ARCHITECTURE.md > Service Architecture |
| Repository | ARCHITECTURE.md > Data Access Layer |

### "Where is...?"

| Code | Location |
|------|----------|
| Entry point | `src/index.mjs` |
| DI container | `src/container.mjs` |
| AI services | `src/services/ai/` |
| Tools | `src/services/tools/` |
| Database | `src/services/foundation/databaseService.mjs` |
| Config | `src/services/foundation/configService.mjs` |
| Utilities | `src/utils/` |

---

## ğŸ“ Learning Path

### Beginner (Day 1)

1. âœ… Read README.md (overview)
2. âœ… Read README.DEVELOPER.md (onboarding)
3. âœ… Run setup wizard
4. âœ… Explore `src/container.mjs` (DI)
5. âœ… Browse `src/services/` structure

### Intermediate (Week 1)

6. âœ… Read ARCHITECTURE.md (design)
7. âœ… Study message flow (MessageHandler â†’ Tools)
8. âœ… Understand AI services (OpenRouter, Google)
9. âœ… Create a simple tool
10. âœ… Add documentation to your code

### Advanced (Month 1)

11. âœ… Understand memory system
12. âœ… Study combat mechanics
13. âœ… Implement a new platform integration
14. âœ… Optimize AI model selection
15. âœ… Contribute to documentation

---

## ğŸ› ï¸ Documentation Tooling

### Generate API Docs

```bash
npm run docs:api
open docs/api/index.html
```

### Check Coverage

```bash
npm run docs:coverage
```

Output:
```
ğŸ“Š Coverage Report

Files:     5/150 (3.3%)
Functions: 10/500 (2.0%)
Classes:   2/50 (4.0%)

Overall Coverage: 3.1%
```

### Watch Mode

```bash
npm run docs:api:watch
# Auto-regenerates on file changes
```

---

## ğŸ“ Contributing Documentation

### Before You Start

1. Read `docs/JSDOC_STANDARDS.md`
2. Check existing examples in documented files
3. Use templates from standards guide

### Minimum Requirements

- [ ] File-level JSDoc with @file, @context, @architecture
- [ ] All public methods have @param, @returns
- [ ] At least one @example per public method
- [ ] Error conditions documented

### Quality Checklist

- [ ] Custom tags used (@context, @architecture, @lifecycle, @dataflow)
- [ ] Examples are complete and runnable
- [ ] Links to related code (@see tags)
- [ ] Performance notes for expensive operations
- [ ] Error handling documented

---

## ğŸ”— External Resources

- [JSDoc Documentation](https://jsdoc.app/)
- [OpenRouter API](https://openrouter.ai/docs)
- [Discord.js Guide](https://discordjs.guide/)
- [Awilix DI](https://github.com/jeffijoe/awilix)
- [MongoDB Node Driver](https://www.mongodb.com/docs/drivers/node/)

---

## ğŸ“ Getting Help

1. **Check Documentation First**
   - README.DEVELOPER.md for common tasks
   - ARCHITECTURE.md for system design
   - JSDoc in code for specific functions

2. **Search Issues**
   - GitHub Issues for known problems
   - Tag: `documentation` for doc issues

3. **Ask the Community**
   - Discord server (if available)
   - Open a GitHub discussion

---

## ğŸ¯ Current Status

**Documentation Phase**: 1 of 6 complete

âœ… **Complete**: Standards, architecture, tooling, core infrastructure  
ğŸ”„ **In Progress**: AI services  
â³ **Next**: Foundation services, chat layer, tools

See `DOCUMENTATION_SUMMARY.md` for detailed status.

---

**Last Updated**: October 10, 2025  
**Maintained By**: CosyWorld Core Team

Quick access:
- [Standards](docs/JSDOC_STANDARDS.md)
- [Architecture](ARCHITECTURE.md)
- [Developer Guide](README.DEVELOPER.md)
- [Summary](DOCUMENTATION_SUMMARY.md)
